var self_eut_hid=false;var $snackbar;timepicker_setup_obj={minuteStep:15,template:false,snapToStep:true,defaultTime:false,disableFocus:true,disableMousewheel:true,explicitMode:true};$(function(){init()});function initSnackbar(){var a={content:"开始时间需要在结束时间之前"};$snackbar=$.snackbar(a);$snackbar.snackbar("hide")}function init(){FastClick.attach(document.body);$.ajaxSetup({beforeSend:function(b,a){if(!csrfSafeMethod(a.type)&&!this.crossDomain){b.setRequestHeader("X-CSRFToken",csrftoken)}}});$.material.init();initTimePickers();initMoments();initSelfEutFromStorage();initUIHandlers();initSnackbar()}function initTimePickers(){$(".timepicker-input").timepicker(timepicker_setup_obj)}function initMoments(){moment.locale("zh-cn");$.each($(".date-str"),function(c,b){var a=$(b).html();var e=moment(a,"YYYY/MM/DD");var d=e.calendar();$(b).html(d)})}function initUIHandlers(){$(".add-time-slot").on("click",function(){var b=$(" <div class='timeslot-group'  data-date='"+$(this).attr("data-date")+"'>                        <div class='col-xs-6 col-md-6 col-lg-2 set-precise-time-cell'>                                <div class='input-group'>                                    <input type='text' class='text-center timepicker-input start-time form-control form-control-pink-A200'                                           placeholder='开始时间' data-hint='智能识别,空白默认全天'>                                    <span class='input-group-addon' style='padding:0px; padding-bottom: 15px;'>                                        <i class='icon-btn-connector mdi-content-remove'></i>                                    </span>                                </div>                        </div>                         <div class='col-xs-6 col-md-6 col-lg-2 set-precise-time-cell'>                                <div class='input-group'>                                    <input type='text'                                           class=' text-center timepicker-input end-time form-control form-control-pink-A200'                                           placeholder='结束时间' data-hint='智能识别,可留白''>                                    <span class='input-group-addon' style='padding:0px; padding-bottom: 15px;'>                                        <i class='icon-btn mdi-content-clear delete-time-slot'></i>                                    </span>                                </div>                            </div>                            </div>");b.insertBefore($(this).parent());initTimePickers();$.material.init()});var a=$("#dates-div");a.on("click",".delete-time-slot",function(){$(this).closest(".timeslot-group").velocity("fadeOut",{duration:500}).promise().done(function(){$(this).remove()})});$("#submit-timeslots").on("click",function(){submitNewEventTimesToServer()});a.timepicker().on("changeTime.timepicker",".timepicker-input",function(g){var b;var c;if($(this).hasClass("end-time")){c=$(this);b=$(this).closest(".timeslot-group").find(".start-time")}else{b=$(this);c=$(this).closest(".timeslot-group").find(".end-time")}if(b.val()!=""&&c.val()!=""){var f=moment(b.val(),"h:mm A");var d=moment(c.val(),"h:mm A");if(f>=d){b.addClass("problematic-time-input");c.addClass("problematic-time-input");$snackbar.snackbar("show")}else{b.removeClass("problematic-time-input");c.removeClass("problematic-time-input");$snackbar.snackbar("hide")}}else{b.removeClass("problematic-time-input");c.removeClass("problematic-time-input");$snackbar.snackbar("hide")}})}function initSelfEutFromStorage(){if(typeof(Storage)!=="undefined"){self_eut_hid=localStorage.getItem(event_hid)}}function submitNewEventTimesToServer(){timeslot_str_arr=[];var a=true;$(".timeslot-group").each(function(){var c=$(this).find(".start-time");var f=$(this).find(".end-time");if(c.hasClass("problematic-time-input")||f.hasClass("problematic-time-input")){c.focus();$snackbar.snackbar("show");a=false;return false}var g=c.val();var h=f.val();if(typeof g!=="undefined"&&typeof h!=="undefined"){var d=$(this).attr("data-date");var e={start_time_str:g,end_time_str:h,date_str:d};timeslot_str_arr.push(e)}});if(!a){return}var b={timeslot_str_json:JSON.stringify(timeslot_str_arr)};if(self_eut_hid){b.self_eut_hid=self_eut_hid}console.log(timeslot_str_arr);$.post(set_times_for_precise_time_event_url,b,function(c){window.location.href=c.url})};